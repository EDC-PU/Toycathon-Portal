
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Users:
    // - Authenticated users can create their own user document.
    // - Users can only read/update their own document.
    match /users/{userId} {
      allow read, update: if request.auth.uid == userId;
      allow create: if request.auth.uid != null;
    }

    // Teams:
    // - Authenticated users can create teams.
    // - The creator of the team can read, update, and delete it.
    // - Any authenticated user can read team details (to see members, etc.).
    match /teams/{teamId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth.uid == resource.data.creatorUid;
    }

    // Submissions:
    // - Users can only create/update their own submission.
    match /submissions/{userId} {
        allow read, create, update: if request.auth.uid == userId;
    }
    
    // Announcements:
    // - All authenticated users can read announcements.
    // - Only admins can write announcements.
    match /announcements/{announcementId} {
        allow read: if request.auth != null;
        allow write: if request.auth.token.admin == true;
    }

    // Counters:
    // - Authenticated users can read and write to the counters collection.
    //   This is needed for the transaction that generates serial team IDs.
    match /counters/{counterId} {
        allow read, write: if request.auth != null;
    }
  }
}

    