rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Function to check if the user is an administrator.
    // This relies on a custom claim 'admin' being set to true for admin users.
    function isAdmin() {
      return request.auth.token.admin == true;
    }

    // Users can read and write their own profile data.
    match /users/{userId} {
      allow read, write: if request.auth != null && (request.auth.uid == userId || isAdmin());
    }

    // Allow anyone to read from a 'toy-ideas' collection, but only admins can write.
    // This is useful for a future feature where you might display all toy submissions.
    match /toy-ideas/{ideaId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // A general rule to allow admins to read/write any other document.
    // This is a fallback and more specific rules should be added as your app grows.
    match /{document=**} {
      allow read, write: if isAdmin();
    }
  }
}
